<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MFC:Simulation: m_derived_variables.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MFC:Simulation
   &#160;<span id="projectnumber">v1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('m__derived__variables_8f90_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">m_derived_variables.f90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="m__derived__variables_8f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">!!       __  _______________</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!!      /  |/  / ____/ ____/</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">!!     / /|_/ / /_  / /     </span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!!    / /  / / __/ / /___   </span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">!!   /_/  /_/_/    \____/   </span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">!!                       </span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">!!  This file is part of MFC.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">!!</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!!  MFC is the legal property of its developers, whose names </span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">!!  are listed in the copyright file included with this source </span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!!  distribution.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">!!</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">!!  MFC is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">!!  it under the terms of the GNU General Public License as published </span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">!!  by the Free Software Foundation, either version 3 of the license </span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!!  or any later version.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">!!</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">!!  MFC is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">!!  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">!!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">!!  GNU General Public License for more details.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">!!  </span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">!!  You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">!!  along with MFC (LICENSE).  </span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">!!  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html">   39</a></span>&#160;<span class="keyword">MODULE</span> <a class="code" href="namespacem__derived__variables.html">m_derived_variables</a></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">! Dependencies =============================================================</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacem__derived__types.html">m_derived_types</a>         !&lt; definitions of the derived types</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    </div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacem__global__parameters.html">m_global_parameters</a>     !&lt; global parameters for the code</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacem__mpi__proxy.html">m_mpi_proxy</a>             !&lt; message passing interface (mpi) module proxy</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacem__data__output.html">m_data_output</a>           !&lt; data output module</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacem__time__steppers.html">m_time_steppers</a>         !&lt; time-stepping algorithms</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">! ==========================================================================</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    </div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordtype">PRIVATE</span>; <span class="keywordtype">PUBLIC</span> :: <a class="code" href="namespacem__derived__variables.html#a15a6d70e2bd1c9b7001c753ca1f2ee27">s_initialize_derived_variables_module</a>   , &amp;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                       <a class="code" href="namespacem__derived__variables.html#ae9dbea9bb47e84dbd380c480ad5144b8">s_initialize_derived_variables</a>          , &amp;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                       <a class="code" href="namespacem__derived__variables.html#a516a9808b3446b7b45029f6451d02b3f">s_compute_derived_variables</a>             , &amp;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                       <a class="code" href="namespacem__derived__variables.html#a735665bf598281689158d9d6e075f3d4">s_finalize_derived_variables_module</a></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">   68</a></span>&#160;    <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">PUBLIC</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">DIMENSION(:,:)</span> :: <a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a></div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">   69</a></span>&#160;    <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">PUBLIC</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">DIMENSION(:,:)</span> :: <a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a></div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">   70</a></span>&#160;    <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">PUBLIC</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">DIMENSION(:,:)</span> :: <a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">CONTAINS</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        </div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        </div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        </div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a15a6d70e2bd1c9b7001c753ca1f2ee27">s_initialize_derived_variables_module</a>() <span class="comment">! ----------------------</span></div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a15a6d70e2bd1c9b7001c753ca1f2ee27">   80</a></span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            </div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="comment">! Allocating the variables which will store the coefficients of the</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="comment">! centered family of finite-difference schemes. Note that sufficient</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="comment">! space is allocated so that the coefficients up to any chosen order</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="comment">! of accuracy may be bookkept. However, if higher than fourth-order</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="comment">! accuracy coefficients are wanted, the formulae required to compute</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="comment">! these coefficients will have to be implemented in the subroutine</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="comment">! s_compute_finite_difference_coefficients.</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            </div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="comment">! Allocating centered finite-difference coefficients</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2de4a56202a6e2f47ce657fcda4ecdb4">probe_wrt</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="keyword">ALLOCATE</span>( <a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(-<a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a> : <a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a>, 0:<a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a>))</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    <span class="keyword">ALLOCATE</span>(<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(-<a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a> : <a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a>, 0:<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a>))</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                        <span class="keyword">ALLOCATE</span>(<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>(-<a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a> : <a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a>, 0:<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a>))</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            </div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a15a6d70e2bd1c9b7001c753ca1f2ee27">s_initialize_derived_variables_module</a> <span class="comment">! --------------------</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        </div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#ae9dbea9bb47e84dbd380c480ad5144b8">s_initialize_derived_variables</a>() <span class="comment">! -----------------------------</span></div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#ae9dbea9bb47e84dbd380c480ad5144b8">  108</a></span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="comment">! Opening and writing header of CoM and flow probe files</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a383c6ff025d4ea09ddd4e2356042d86b">proc_rank</a> == 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">IF</span> (any(<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#a36714d4cf746d5beb2736752fdd6d747">s_open_com_files</a>()</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="keywordflow">IF</span> (any(<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#a411af1336ca1bc899d3b7352d9383a81">s_open_cb_files</a>()</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2de4a56202a6e2f47ce657fcda4ecdb4">probe_wrt</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#af469c3d867d96eb1ca255832e586ec97">s_open_probe_files</a>()</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        </div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        </div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="comment">! Computing centered finite difference coefficients</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2de4a56202a6e2f47ce657fcda4ecdb4">probe_wrt</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a908281ae7fe786ef19397e268ede0ece">s_compute_finite_difference_coefficients</a>(<a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a>,<a class="code" href="namespacem__global__parameters.html#aea5b911d65b330f65e97052e9e8c0383">x_cc</a>,<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a908281ae7fe786ef19397e268ede0ece">s_compute_finite_difference_coefficients</a>(<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a>,<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>,<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a908281ae7fe786ef19397e268ede0ece">s_compute_finite_difference_coefficients</a>(<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a>,<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>,<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#ae9dbea9bb47e84dbd380c480ad5144b8">s_initialize_derived_variables</a> <span class="comment">! -----------------------------</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a516a9808b3446b7b45029f6451d02b3f">s_compute_derived_variables</a>(t_step) <span class="comment">! -----------------------</span></div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a516a9808b3446b7b45029f6451d02b3f">  142</a></span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: t_step</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,j,k</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">IF</span> ((any(<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>) .OR. any(<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>) .OR. <a class="code" href="namespacem__global__parameters.html#a2de4a56202a6e2f47ce657fcda4ecdb4">probe_wrt</a>) .AND. (t_step &gt; <a class="code" href="namespacem__global__parameters.html#ace0c8a67825d0dccd2e23b5d0f9985c0">t_step_start</a> + 2)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="keywordflow">IF</span> (any(<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a1a849dc545128f9a6de155bed61035ff">s_derive_center_of_mass</a>(<a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, &amp;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                                 <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(1)%vf, &amp;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                                 <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(2)%vf, &amp;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                                                 <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(3)%vf, &amp;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                                 <a class="code" href="namespacem__data__output.html#ac5b476661d64159fdcd7364715495f30">q_com</a>)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#ab28af564606ca901d3953e6012e9a452">s_derive_higher_moments</a>(<a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, <a class="code" href="namespacem__data__output.html#abd8505e33c0dce0f0aba7e27ae53bef5">moments</a>)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#a6be3381410dd028014de2c1d02b05139">s_write_com_files</a>(t_step,<a class="code" href="namespacem__data__output.html#ac5b476661d64159fdcd7364715495f30">q_com</a>,<a class="code" href="namespacem__data__output.html#abd8505e33c0dce0f0aba7e27ae53bef5">moments</a>)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        </div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                <span class="keywordflow">IF</span> (any(<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#abdf1859a7ad678848feb69bbe89a2f95">s_derive_fluid_bounds</a>(<a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, <a class="code" href="namespacem__data__output.html#a1e7a93a0d32bbc7c691381689771b6f9">bounds</a>)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a2472e46739cdedf315aefa209a08f211">s_derive_coherent_body</a>(<a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, <a class="code" href="namespacem__data__output.html#a775b8128a9261b4d095f9132508d309f">cb_mass</a>)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a976bfd341efaba6840dc23d6abc4f29e">s_derive_centerline</a>(<a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, <a class="code" href="namespacem__data__output.html#a4f2a6c0ed44fb82d337013e700479ce5">cntrline</a>)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#a40724c992117a24479573d9fbcdfa21b">s_write_cb_files</a>(t_step,<a class="code" href="namespacem__data__output.html#a775b8128a9261b4d095f9132508d309f">cb_mass</a>,<a class="code" href="namespacem__data__output.html#a1e7a93a0d32bbc7c691381689771b6f9">bounds</a>,<a class="code" href="namespacem__data__output.html#a4f2a6c0ed44fb82d337013e700479ce5">cntrline</a>)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        </div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2de4a56202a6e2f47ce657fcda4ecdb4">probe_wrt</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a5c6df8a69a463ae2c56fb2c2bb8c59a7">s_derive_acceleration_component</a>(1, <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, &amp;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                                            <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(1)%vf, &amp;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                                            <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(2)%vf, &amp;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                                            <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(3)%vf, &amp;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                                            <a class="code" href="namespacem__data__output.html#ac465283e56b508af6500bea1ad4c745c">x_accel</a>)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a5c6df8a69a463ae2c56fb2c2bb8c59a7">s_derive_acceleration_component</a>(2, <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, &amp;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                                                <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(1)%vf, &amp;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                                                <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(2)%vf, &amp;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                                                <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(3)%vf, &amp;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                                                <a class="code" href="namespacem__data__output.html#a9170ca95f1f4493fd30a48052ed214a7">y_accel</a>)</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a5c6df8a69a463ae2c56fb2c2bb8c59a7">s_derive_acceleration_component</a>(3, <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(0)%vf, &amp;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                                                    <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(1)%vf, &amp;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                                                    <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(2)%vf, &amp;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                                                    <a class="code" href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">q_prim_ts</a>(3)%vf, &amp;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                                                    <a class="code" href="namespacem__data__output.html#aef4cabc25090173d5817782631af2781">z_accel</a>)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        </div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                            <span class="keywordflow">DO</span> i = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                    <a class="code" href="namespacem__data__output.html#a1ccababc9891f8a719df1c52b49e969a">accel_mag</a>(i,j,k) = sqrt(<a class="code" href="namespacem__data__output.html#ac465283e56b508af6500bea1ad4c745c">x_accel</a>(i,j,k)**2d0 + &amp;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                                            <a class="code" href="namespacem__data__output.html#a9170ca95f1f4493fd30a48052ed214a7">y_accel</a>(i,j,k)**2d0 + &amp;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                                            <a class="code" href="namespacem__data__output.html#aef4cabc25090173d5817782631af2781">z_accel</a>(i,j,k)**2d0)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                    <a class="code" href="namespacem__data__output.html#a1ccababc9891f8a719df1c52b49e969a">accel_mag</a>(i,j,k) = sqrt(<a class="code" href="namespacem__data__output.html#ac465283e56b508af6500bea1ad4c745c">x_accel</a>(i,j,k)**2d0 + &amp;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                                            <a class="code" href="namespacem__data__output.html#a9170ca95f1f4493fd30a48052ed214a7">y_accel</a>(i,j,k)**2d0)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                                    <a class="code" href="namespacem__data__output.html#a1ccababc9891f8a719df1c52b49e969a">accel_mag</a>(i,j,k) = <a class="code" href="namespacem__data__output.html#ac465283e56b508af6500bea1ad4c745c">x_accel</a>(i,j,k)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        </div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#a29f34883bc8e9d895dbb4232493397a1">s_write_probe_files</a>(t_step,<a class="code" href="namespacem__time__steppers.html#a4bbe3aedc07e11e85679ec0c7a094f37">q_cons_ts</a>(1)%vf,<a class="code" href="namespacem__data__output.html#a1ccababc9891f8a719df1c52b49e969a">accel_mag</a>)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a516a9808b3446b7b45029f6451d02b3f">s_compute_derived_variables</a> <span class="comment">! ---------------------------</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a908281ae7fe786ef19397e268ede0ece">s_compute_finite_difference_coefficients</a>(    q,s_cc, fd_coeff_s  )</div><div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a908281ae7fe786ef19397e268ede0ece">  224</a></span>&#160;           </div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: q</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            </div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, &amp;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordtype">DIMENSION(-buff_size:q+buff_size)</span>, &amp;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordtype">INTENT(IN)</span> :: s_cc</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, &amp;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordtype">DIMENSION(-fd_number:fd_number,0:q)</span>, &amp;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordtype">INTENT(INOUT)</span> :: fd_coeff_s</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            </div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordtype">INTEGER</span> :: i</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            </div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            </div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="comment">! Computing the 1st order finite-difference coefficients</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="namespacem__global__parameters.html#a8892cc67c7d04be4d8e6d02a86e209bc">fd_order</a> == 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">DO</span> i = 0, q</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    fd_coeff_s(-1,i) =  0d0</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    fd_coeff_s( 0,i) = -1d0 / (s_cc(i+1) - s_cc(i))</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    fd_coeff_s( 1,i) = -fd_coeff_s(0,i)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                </div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="comment">! Computing the 2nd order finite-difference coefficients</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">ELSEIF</span>(<a class="code" href="namespacem__global__parameters.html#a8892cc67c7d04be4d8e6d02a86e209bc">fd_order</a> == 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="keywordflow">DO</span> i = 0, q</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    fd_coeff_s(-1,i) = -1d0 / (s_cc(i+1) - s_cc(i-1))</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    fd_coeff_s( 0,i) =  0d0</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    fd_coeff_s( 1,i) = -fd_coeff_s(-1,i)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                </div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="comment">! Computing the 4th order finite-difference coefficients</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">DO</span> i = 0, q</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    fd_coeff_s(-2,i) =  1d0 / (s_cc(i-2) - 8d0*s_cc(i-1) - s_cc(i+2) + 8d0*s_cc(i+1))</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    fd_coeff_s(-1,i) = -8d0 * fd_coeff_s(-2,i)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    fd_coeff_s( 0,i) =  0d0</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    fd_coeff_s( 1,i) = -fd_coeff_s(-1,i)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                    fd_coeff_s( 2,i) = -fd_coeff_s(-2,i)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                </div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            </div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            </div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a908281ae7fe786ef19397e268ede0ece">s_compute_finite_difference_coefficients</a> <span class="comment">! --------------</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        </div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        </div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a5c6df8a69a463ae2c56fb2c2bb8c59a7">s_derive_acceleration_component</a>(i, q_prim_vf, q_prim_vf1, &amp;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                            q_prim_vf2, q_prim_vf3, q_sf) <span class="comment">! ----------</span></div><div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a5c6df8a69a463ae2c56fb2c2bb8c59a7">  286</a></span>&#160;           </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            </div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: i</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf1</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf2</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf3</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(0:m,0:n,0:p)</span>, <span class="keywordtype">INTENT(OUT)</span> :: q_sf</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            </div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordtype">INTEGER</span> :: j,k,l,r</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            </div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="comment">! Computing the acceleration component in the x-coordinate direction</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">IF</span>(i == 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                            q_sf(j,k,l) = (11d0*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l) &amp; </div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                                        - 18d0*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l) &amp;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                                        +  9d0*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l) &amp;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                        -  2d0*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l) ) / (6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                            </div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                            <span class="keywordflow">DO</span> r = -<a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a>, <a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                <span class="keywordflow">IF</span> ( <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> == 0) <span class="keywordflow">THEN</span> <span class="comment">! 1D simulation</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                    q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                        + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(r+j, k , l )</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                <span class="keywordflow">ELSEIF</span> ( <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> == 0) <span class="keywordflow">THEN</span> <span class="comment">! 2D simulation</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                    q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                        + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                        + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf( j ,r+k, l )</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                <span class="keywordflow">ELSE</span> <span class="comment">! 3D simulation</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                        q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                            + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf( j ,r+k, l ) &amp;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>(r,l) * &amp;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf( j , k ,r+l)/<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                                    <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                        q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                            + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf( j ,r+k, l ) &amp;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>(r,l) * &amp;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf( j , k ,r+l)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="keywordflow">                                    END IF</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                </div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                </div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="comment">! Computing the acceleration component in the y-coordinate direction</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">ELSEIF</span>(i == 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                            </div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                            q_sf(j,k,l) = (11d0*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l) &amp; </div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                        - 18d0*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l) &amp;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                        +  9d0*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l) &amp;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                        -  2d0*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l) ) / (6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                            </div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                            <span class="keywordflow">DO</span> r = -<a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a>, <a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                <span class="keywordflow">IF</span> ( <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> == 0) <span class="keywordflow">THEN</span> <span class="comment">! 2D simulation</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                    q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                        + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                        + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf( j ,r+k, l )</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                <span class="keywordflow">ELSE</span> <span class="comment">! 3D simulation</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                                        q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                            + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp; </div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf( j ,r+k, l ) &amp;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>(r,l) * &amp; </div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf( j , k ,r+l)/<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k) &amp;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                            -(q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l)**2d0)/<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                    <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                        q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                            + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf( j ,r+k, l ) &amp;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                                            + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>(r,l) * &amp;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf( j , k ,r+l)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keywordflow">                                    END IF</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                </div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                </div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="comment">! Computing the acceleration component in the z-coordinate direction</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                            q_sf(j,k,l) = (11d0*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l) &amp; </div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                        - 18d0*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l) &amp;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                        +  9d0*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l) &amp;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                        -  2d0*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l) ) / (6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                            </div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                            <span class="keywordflow">DO</span> r = -<a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a>, <a class="code" href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">fd_number</a></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                                    q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                                        + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                        + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf( j ,r+k, l ) &amp;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                        + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>(r,l) * &amp;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf( j , k ,r+l)/<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k) &amp;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                                        +(q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l) * &amp;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l))/<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                    q_sf(j,k,l) = q_sf(j,k,l) &amp;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                        + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>(r,j) * &amp;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(r+j, k , l ) &amp;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                        + q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>(r,k) * &amp;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf( j ,r+k, l ) &amp;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                        + q_prim_vf( <a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end )%sf(j,k,l)*<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>(r,l) * &amp;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                        q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf( j , k ,r+l)</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            </div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            </div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a5c6df8a69a463ae2c56fb2c2bb8c59a7">s_derive_acceleration_component</a> <span class="comment">! --------------------------</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a1a849dc545128f9a6de155bed61035ff">s_derive_center_of_mass</a>(q_prim_vf,q_prim_vf1,q_prim_vf2,q_prim_vf3,q_com)</div><div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a1a849dc545128f9a6de155bed61035ff">  446</a></span>&#160;           </div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf1</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf2</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf3</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,10)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: q_com</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: xbeg,xend,ybeg,yend,zbeg,zend</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,j,k,l</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: tmp</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: dV</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: cart_u_x,  cart_u_y, &amp;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                               cart_u_x1, cart_u_y1,&amp;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                               cart_u_x2, cart_u_y2,&amp;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                               cart_u_x3, cart_u_y3</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> == 0)  <span class="keywordflow">THEN</span> <span class="comment">!1D simulation</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                        q_com(i,:) = 0d0</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                        <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> <span class="comment">!Loop over grid</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                            <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                    </div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                    dv = <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                                    <span class="comment">! Mass</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                                    q_com(i,1) = q_com(i,1) + q_prim_vf(i)%sf(j,k,l)*dv</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                    <span class="comment">! x-location weighted</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                                    q_com(i,2) = q_com(i,2) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aea5b911d65b330f65e97052e9e8c0383">x_cc</a>(j)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                    <span class="comment">! x-velocity weighted</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                    q_com(i,5) = q_com(i,5) + q_prim_vf(i)%sf(j,k,l)*dv*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                    <span class="comment">! x-acceleration weighted</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                    q_com(i,8) = q_com(i,8) + dv*(  11d0*( q_prim_vf(i)%sf(j,k,l) &amp;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                                                    * q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                                    - 18d0*(q_prim_vf1(i)%sf(j,k,l)*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                                    +  9d0*(q_prim_vf2(i)%sf(j,k,l)*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                                    -  2d0*(q_prim_vf3(i)%sf(j,k,l)*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                        <span class="comment">! Sum all components across all processors using MPI_ALLREDUCE</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                            tmp = q_com(i,1)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,1))</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                            tmp = q_com(i,2)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,2))</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                            tmp = q_com(i,5)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,5))</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                            tmp = q_com(i,8)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,8))</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                        <span class="comment">! Compute quotients</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                        q_com(i,2) = q_com(i,2)/q_com(i,1)</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                        q_com(i,5) = q_com(i,5)/q_com(i,1)</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                        q_com(i,8) = q_com(i,8)/q_com(i,1)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> == 0) <span class="keywordflow">THEN</span> <span class="comment">!2D simulation</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        q_com(i,:) = 0d0</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                        <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> <span class="comment">!Loop over grid</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                            <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                    dv = <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                    <span class="comment">! Mass</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                    q_com(i,1) = q_com(i,1) + q_prim_vf(i)%sf(j,k,l)*dv</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                    <span class="comment">! x-location weighted</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                                    q_com(i,2) = q_com(i,2) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aea5b911d65b330f65e97052e9e8c0383">x_cc</a>(j)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                                    <span class="comment">! y-location weighted</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                    q_com(i,3) = q_com(i,3) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                                    <span class="comment">! x-velocity weighted</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                    q_com(i,5) = q_com(i,5) + q_prim_vf(i)%sf(j,k,l)*dv*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                    <span class="comment">! y-velocity weighted</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                    q_com(i,6) = q_com(i,6) + q_prim_vf(i)%sf(j,k,l)*dv*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                    <span class="comment">! x-acceleration weighted</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                    q_com(i,8) = q_com(i,8) + dv* &amp;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                        (  11d0*( q_prim_vf(i)%sf(j,k,l)* q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                        - 18d0*(q_prim_vf1(i)%sf(j,k,l)*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                        +  9d0*(q_prim_vf2(i)%sf(j,k,l)*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                        -  2d0*(q_prim_vf3(i)%sf(j,k,l)*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                    <span class="comment">! y-acceleration weighted</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                    q_com(i,9) = q_com(i,9) + dv * &amp;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                                        (  11d0*( q_prim_vf(i)%sf(j,k,l)* q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                        - 18d0*(q_prim_vf1(i)%sf(j,k,l)*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                        +  9d0*(q_prim_vf2(i)%sf(j,k,l)*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                        -  2d0*(q_prim_vf3(i)%sf(j,k,l)*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                        <span class="comment">! Sum all components across all processors using MPI_ALLREDUCE</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                            tmp = q_com(i,1)</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,1))</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                            tmp = q_com(i,2)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,2))</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                            tmp = q_com(i,3)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,3))</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                            tmp = q_com(i,5)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,5))</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                            tmp = q_com(i,6)</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,6))</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                            tmp = q_com(i,8)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,8))</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                            tmp = q_com(i,9)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,9))</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                        <span class="comment">! Compute quotients</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                        q_com(i,2) = q_com(i,2)/q_com(i,1)</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                        q_com(i,3) = q_com(i,3)/q_com(i,1)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                        q_com(i,5) = q_com(i,5)/q_com(i,1)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                        q_com(i,6) = q_com(i,6)/q_com(i,1)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        q_com(i,8) = q_com(i,8)/q_com(i,1)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        q_com(i,9) = q_com(i,9)/q_com(i,1)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordflow">ELSE</span> <span class="comment">!3D simulation</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        q_com(i,:) = 0d0</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                        <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> <span class="comment">!Loop over grid</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                            <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                                <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                                        dv = (2d0*<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k) + <a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)**2d0)/2d0*<a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                        cart_u_x  =  q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) - &amp; </div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                                        cart_u_y  =  q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) + &amp;  </div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                                            q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                        cart_u_x1 = q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) - &amp; </div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                            q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                        cart_u_y1 = q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) + &amp; </div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                            q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                        cart_u_x2 = q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) - &amp; </div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                            q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                        cart_u_y2 = q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) + &amp; </div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                            q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                                        cart_u_x3 = q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) - &amp; </div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                            q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                        cart_u_y3 = q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)) + &amp; </div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                            q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                                        <span class="comment">! Mass</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                        q_com(i,1) = q_com(i,1) + q_prim_vf(i)%sf(j,k,l)*dv</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                                        <span class="comment">! x-location weighted</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                                        q_com(i,2) = q_com(i,2) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                                        <span class="comment">! y-location weighted</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                        q_com(i,3) = q_com(i,3) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                        <span class="comment">! z-location weighted</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                                        q_com(i,4) = q_com(i,4) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aea5b911d65b330f65e97052e9e8c0383">x_cc</a>(j)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                        <span class="comment">! x-velocity weighted</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                        q_com(i,5) = q_com(i,5) + q_prim_vf(i)%sf(j,k,l)*dv*cart_u_x</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                        <span class="comment">! y-velocity weighted</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                        q_com(i,6) = q_com(i,6) + q_prim_vf(i)%sf(j,k,l)*dv*cart_u_y</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                        <span class="comment">! z-velocity weighted</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                        q_com(i,7) = q_com(i,7) + q_prim_vf(i)%sf(j,k,l)*dv*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                        <span class="comment">! x-acceleration weighted</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                        q_com(i,8) = q_com(i,8) + dv * &amp;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                            (  11d0*( q_prim_vf(i)%sf(j,k,l)*cart_u_x ) &amp;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                            - 18d0*(q_prim_vf1(i)%sf(j,k,l)*cart_u_x1) &amp;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                            +  9d0*(q_prim_vf2(i)%sf(j,k,l)*cart_u_x2) &amp;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                            -  2d0*(q_prim_vf3(i)%sf(j,k,l)*cart_u_x3))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                        <span class="comment">! y-acceleration weighted</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                        q_com(i,9) = q_com(i,9) + dv * &amp;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                            (  11d0*( q_prim_vf(i)%sf(j,k,l)*cart_u_y ) &amp;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                                - 18d0*(q_prim_vf1(i)%sf(j,k,l)*cart_u_y1) &amp;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                                +  9d0*(q_prim_vf2(i)%sf(j,k,l)*cart_u_y2) &amp;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                                -  2d0*(q_prim_vf3(i)%sf(j,k,l)*cart_u_y3))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                                        <span class="comment">! z-acceleration weighted</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                        q_com(i,10) = q_com(i,10) + dv * &amp;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                                            (  11d0*( q_prim_vf(i)%sf(j,k,l)* q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                            - 18d0*(q_prim_vf1(i)%sf(j,k,l)*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                                            +  9d0*(q_prim_vf2(i)%sf(j,k,l)*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                                            -  2d0*(q_prim_vf3(i)%sf(j,k,l)*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                                    <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                        dv = <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)*<a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                        <span class="comment">! Mass</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                        q_com(i,1) = q_com(i,1) + q_prim_vf(i)%sf(j,k,l)*dv</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                        <span class="comment">! x-location weighted</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                        q_com(i,2) = q_com(i,2) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aea5b911d65b330f65e97052e9e8c0383">x_cc</a>(j)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                        <span class="comment">! y-location weighted</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                        q_com(i,3) = q_com(i,3) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                                        <span class="comment">! z-location weighted</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                        q_com(i,4) = q_com(i,4) + q_prim_vf(i)%sf(j,k,l)*dv*<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                        <span class="comment">! x-velocity weighted</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                        q_com(i,5) = q_com(i,5) + q_prim_vf(i)%sf(j,k,l)*dv*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                                        <span class="comment">! y-velocity weighted</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                        q_com(i,6) = q_com(i,6) + q_prim_vf(i)%sf(j,k,l)*dv*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                                        <span class="comment">! z-velocity weighted</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                        q_com(i,7) = q_com(i,7) + q_prim_vf(i)%sf(j,k,l)*dv*q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                                        <span class="comment">! x-acceleration weighted</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                                        q_com(i,8) = q_com(i,8) + dv * &amp;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                            (  11d0*( q_prim_vf(i)%sf(j,k,l)* q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                            - 18d0*(q_prim_vf1(i)%sf(j,k,l)*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                                            +  9d0*(q_prim_vf2(i)%sf(j,k,l)*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                            -  2d0*(q_prim_vf3(i)%sf(j,k,l)*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg)%sf(j,k,l)))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                                        <span class="comment">! y-acceleration weighted</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                                        q_com(i,9) = q_com(i,9) + dv * &amp;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                                            (  11d0*( q_prim_vf(i)%sf(j,k,l)* q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                                            - 18d0*(q_prim_vf1(i)%sf(j,k,l)*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                                            +  9d0*(q_prim_vf2(i)%sf(j,k,l)*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                            -  2d0*(q_prim_vf3(i)%sf(j,k,l)*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%beg+1)%sf(j,k,l)))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                        <span class="comment">! z-acceleration weighted</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                        q_com(i,10) = q_com(i,10) + dv * &amp;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                                            (  11d0*( q_prim_vf(i)%sf(j,k,l)* q_prim_vf(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                                            - 18d0*(q_prim_vf1(i)%sf(j,k,l)*q_prim_vf1(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                            +  9d0*(q_prim_vf2(i)%sf(j,k,l)*q_prim_vf2(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)) &amp;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                                            -  2d0*(q_prim_vf3(i)%sf(j,k,l)*q_prim_vf3(<a class="code" href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">mom_idx</a>%end)%sf(j,k,l)))/(6d0*<a class="code" href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">dt</a>)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="keywordflow">                                    END IF</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                        <span class="comment">! Sum all components across all processors using MPI_ALLREDUCE</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                            tmp = q_com(i,1)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,1))</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                            tmp = q_com(i,2)</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,2))</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                            tmp = q_com(i,3)</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,3))</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                            tmp = q_com(i,4)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,4))</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                            tmp = q_com(i,5)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,5))</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                            tmp = q_com(i,6)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,6))</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                            tmp = q_com(i,7)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,7))</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                            tmp = q_com(i,8)</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,8))</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                            tmp = q_com(i,9)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,9))</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                            tmp = q_com(i,10)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                            <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,q_com(i,10))</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                        <span class="comment">! Compute quotients</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                        q_com(i,2) = q_com(i,2)/q_com(i,1)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        q_com(i,3) = q_com(i,3)/q_com(i,1)</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                        q_com(i,4) = q_com(i,4)/q_com(i,1)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                        q_com(i,5) = q_com(i,5)/q_com(i,1)</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                        q_com(i,6) = q_com(i,6)/q_com(i,1)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                        q_com(i,7) = q_com(i,7)/q_com(i,1)</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                        q_com(i,8) = q_com(i,8)/q_com(i,1)</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                        q_com(i,9) = q_com(i,9)/q_com(i,1)</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                        q_com(i,10) = q_com(i,10)/q_com(i,1)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="comment">! Find computational domain boundaries</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(minval(<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a>)),xbeg)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(maxval(<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a>)),xend)</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(minval(<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a>)),ybeg)</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(maxval(<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a>)),yend)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(minval(<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a>)),zbeg)</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(maxval(<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a>)),zend)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                xbeg = minval(<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a>))</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                xend = maxval(<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a>))</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    ybeg = minval(<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a>))</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                    yend = maxval(<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a>))</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        zbeg = minval(<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a>))</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                        zend = maxval(<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(-1:<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a>))</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">DO</span> i = 1, <a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                    <span class="comment">! Check for reflective BC in x-direction</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a18f8ba3144b698c2753731b6e27fc581">bc_x_glb</a>%beg == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                        q_com(i,1) = q_com(i,1)*2d0</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        q_com(i,2) = xbeg</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                        q_com(i,5) = 0d0</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                        q_com(i,8) = 0d0</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                    <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#a18f8ba3144b698c2753731b6e27fc581">bc_x_glb</a>%end == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                        q_com(i,1) = q_com(i,1)*2d0</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        q_com(i,2) = xend</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                        q_com(i,5) = 0d0</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                        q_com(i,8) = 0d0</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                    <span class="keywordflow">IF</span> ( <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0 ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                        <span class="comment">! Check for reflective BC in y-direction</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%beg == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                            q_com(i,1) = q_com(i,1)*2d0</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                            q_com(i,3) = ybeg</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                            q_com(i,6) = 0d0</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                            q_com(i,9) = 0d0</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                        <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%end == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                            q_com(i,1) = q_com(i,1)*2d0</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                            q_com(i,3) = yend</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                            q_com(i,6) = 0d0</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                            q_com(i,9) = 0d0</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                        <span class="keywordflow">IF</span> ( <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0 ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                            <span class="comment">! Check for reflective BC in z-direction</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%beg == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                q_com(i,1) = q_com(i,1)*2d0</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                q_com(i,4) = zbeg</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                q_com(i,7) = 0d0</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                                q_com(i,10) = 0d0</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                            <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%end == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                                q_com(i,1) = q_com(i,1)*2d0</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                                q_com(i,4) = zend</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                q_com(i,7) = 0d0</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                q_com(i,10) = 0d0</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                            </div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                        </div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a1a849dc545128f9a6de155bed61035ff">s_derive_center_of_mass</a> <span class="comment">! ----------------------------------</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#ab28af564606ca901d3953e6012e9a452">s_derive_higher_moments</a>(q_prim_vf, moments)</div><div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#ab28af564606ca901d3953e6012e9a452">  803</a></span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,2,5)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: moments</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,r</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="comment">! Using the global boundary conditions, determine method of computing</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <span class="comment">! higher moments for y-direction</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span> </div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                <span class="keywordflow">IF</span> ((<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%beg /= -2) .AND. (<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%end /= -2)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                    <span class="comment">! Non-symmetric moments</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a2ee18c156bb444c6ab73d4762960ef67">s_non_symmetric_moments</a>(q_prim_vf, moments, 1)</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                <span class="keywordflow">ELSEIF</span> (((<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%beg == -2) .AND. (<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%end == -2)) &amp; </div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                            .OR. &amp;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    ((<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%beg == -1) .AND. (<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%end == -1))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                    print <span class="stringliteral">&#39;(A)&#39;</span>, <span class="stringliteral">&#39;Periodic boundary conditions in y-direction. &#39;</span> // &amp;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                        <span class="stringliteral">&#39;Cannot compute higher moments. Exiting...&#39;</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a04ac565bad2b22dc045a5eeb4f516e2e">s_mpi_abort</a>()</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#ade52fa354cc5b681c4d6ef6fc8b2c61b">s_symmetric_moments</a>(q_prim_vf, moments, 1)</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                    <span class="keywordflow">IF</span> ((<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%beg /= -2) .AND. (<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%end /= -2)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                        <span class="comment">! Non-symmetric moments</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#a2ee18c156bb444c6ab73d4762960ef67">s_non_symmetric_moments</a>(q_prim_vf, moments, 2)</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                    <span class="keywordflow">ELSEIF</span> (((<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%beg == -2) .AND. (<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%end == -2)) &amp; </div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                                .OR. &amp; </div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                        ((<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%beg == -1) .AND. (<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%end == -1))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                        print <span class="stringliteral">&#39;(A)&#39;</span>, <span class="stringliteral">&#39;Periodic boundary conditions in z-direction. &#39;</span> // &amp;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                            <span class="stringliteral">&#39;Cannot compute higher moments. Exiting...&#39;</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a04ac565bad2b22dc045a5eeb4f516e2e">s_mpi_abort</a>()</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                    <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                        <span class="keyword">CALL </span><a class="code" href="namespacem__derived__variables.html#ade52fa354cc5b681c4d6ef6fc8b2c61b">s_symmetric_moments</a>(q_prim_vf, moments, 2)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <span class="keywordflow">ELSE</span> <span class="comment">!1D simulation</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                        <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a4e4e3806190a62a77cf6542f6d07dbbd">dflt_int</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                moments(i,:,r) = 0d0</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                moments(i,:,r) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#ab28af564606ca901d3953e6012e9a452">s_derive_higher_moments</a> <span class="comment">! -----------------------------------------</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a2ee18c156bb444c6ab73d4762960ef67">s_non_symmetric_moments</a>(q_prim_vf, moments, dir) <span class="comment">! ---------------------</span></div><div class="line"><a name="l00864"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a2ee18c156bb444c6ab73d4762960ef67">  864</a></span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,2,5)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: moments</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: dir</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,5)</span> :: pos_numer, neg_numer, pos_denom, neg_denom</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: numer_weight</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: main_term</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: dV</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: cart_x, cart_y</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,j,k,l,r</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: tmp</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            <span class="keywordflow">DO</span> i = 1, <a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                pos_numer(i,:) = 0d0</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                neg_numer(i,:) = 0d0</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                pos_denom(i,:) = 0d0</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                neg_denom(i,:) = 0d0</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                    <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a4e4e3806190a62a77cf6542f6d07dbbd">dflt_int</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                            <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                    <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                        <span class="keywordflow">IF</span> (q_prim_vf(i)%sf(j,k,l) &gt; 5d-1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                                dv = (2d0*<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k) + <a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)**2d0)/2d0*<a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                                                cart_x = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                                cart_y = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                                main_term =       q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)  * &amp;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                                           (1d0 - q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)) * dv</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                                <span class="keywordflow">IF</span> ((dir == 1) .AND. (cart_x &gt;= 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                                                    numer_weight = cart_x**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    </div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                                                    pos_numer(i,r) = pos_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                                    pos_denom(i,r) = pos_denom(i,r) + main_term</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((dir == 1) .AND. (cart_x &lt; 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                                                    numer_weight = cart_x**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    </div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                                    neg_numer(i,r) = neg_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                                    neg_denom(i,r) = neg_denom(i,r) + main_term</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((dir == 2) .AND. (cart_y &gt;= 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                                                    numer_weight = cart_y**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    </div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                                    pos_numer(i,r) = pos_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                                                    pos_denom(i,r) = pos_denom(i,r) + main_term</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((dir == 2) .AND. (cart_y &lt; 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                                    numer_weight = cart_y**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    </div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                                    neg_numer(i,r) = neg_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                                    neg_denom(i,r) = neg_denom(i,r) + main_term</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                                    main_term =       q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)  * &amp;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                                                               (1d0 - q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)) * &amp;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                                               <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                                        main_term = main_term * <a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="keywordflow">                                                    END IF</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                                <span class="keywordflow">IF</span> ((dir == 1) .AND. (<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k) &gt;= 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                                                    numer_weight = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    </div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                                    pos_numer(i,r) = pos_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                                                    pos_denom(i,r) = pos_denom(i,r) + main_term</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((dir == 1) .AND. (<a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k) &lt; 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                                                    numer_weight = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    </div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                                                    neg_numer(i,r) = neg_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                                                    neg_denom(i,r) = neg_denom(i,r) + main_term</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((dir == 2) .AND. (<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l) &gt;= 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                                                    numer_weight = <a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    </div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                                                    pos_numer(i,r) = pos_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                                                    pos_denom(i,r) = pos_denom(i,r) + main_term</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((dir == 2) .AND. (<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l) &lt; 0d0)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                                                    numer_weight = <a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    </div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                                                    neg_numer(i,r) = neg_numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                                                    neg_denom(i,r) = neg_denom(i,r) + main_term</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="keywordflow">                                        END IF</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                            <span class="comment">! Sum all components across all procs using MPI_ALLREDUCE</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                                tmp = pos_numer(i,r)</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,pos_numer(i,r))</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                                tmp = neg_numer(i,r)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,neg_numer(i,r))</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                                tmp = pos_denom(i,r)</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,pos_denom(i,r))</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                                tmp = neg_denom(i,r)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,neg_denom(i,r))</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                            <span class="comment">! Compute quotients and sum to get total moment</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                            moments(i,dir,r) = (pos_numer(i,r)/pos_denom(i,r))**(1d0/<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)) + &amp;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                       (neg_numer(i,r)/neg_denom(i,r))**(1d0/<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r))</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                            moments(i,dir,r) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a2ee18c156bb444c6ab73d4762960ef67">s_non_symmetric_moments</a> <span class="comment">! ------------------------------------------ </span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#ade52fa354cc5b681c4d6ef6fc8b2c61b">s_symmetric_moments</a>(q_prim_vf, moments, dir) <span class="comment">! ---------------------</span></div><div class="line"><a name="l00984"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#ade52fa354cc5b681c4d6ef6fc8b2c61b">  984</a></span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,2,5)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: moments</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: dir</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,5)</span> :: numer, denom</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: numer_weight</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: main_term</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: dV</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: cart_x, cart_y</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: tmp</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,j,k,l,r</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            <span class="keywordflow">DO</span> i = 1, <a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                numer(i,:) = 0d0</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                denom(i,:) = 0d0</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                    <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a4e4e3806190a62a77cf6542f6d07dbbd">dflt_int</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                            <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                                <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                                    <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                                        <span class="keywordflow">IF</span> (q_prim_vf(i)%sf(j,k,l) &gt; 5d-1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                                                dv = (2d0*<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k) + <a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)**2d0)/2d0*<a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                                                cart_x = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                                                cart_y = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                                main_term =       q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)  * &amp;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                                           (1d0 - q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)) * dv</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                                                <span class="keywordflow">IF</span> (dir == 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                                                    numer_weight = cart_x**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        </div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                                                    numer(i,r) = numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                                    denom(i,r) = denom(i,r) + main_term</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                                                <span class="keywordflow">ELSEIF</span> (dir == 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                                                    numer_weight = cart_y**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        </div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                                                    numer(i,r) = numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                                                    denom(i,r) = denom(i,r) + main_term</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                                                    main_term =       q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)  * &amp;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                                                               (1d0 - q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l)) * &amp;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                                                               <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                                                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                                        main_term = main_term * <a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="keywordflow">                                                    END IF</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                                                <span class="keywordflow">IF</span> (dir == 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                                                    numer_weight = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        </div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                                                    numer(i,r) = numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                                                    denom(i,r) = denom(i,r) + main_term</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                                                <span class="keywordflow">ELSEIF</span> (dir == 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                                                    numer_weight = <a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l)**<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r)</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        </div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                                                    numer(i,r) = numer(i,r) + numer_weight * main_term</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                                                    denom(i,r) = denom(i,r) + main_term</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="keywordflow">                                        END IF</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                            <span class="comment">! Sum all components across all procs using MPI_ALLREDUCE</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                                tmp = numer(i,r)</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,numer(i,r))</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                                tmp = denom(i,r)</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,denom(i,r))</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                            <span class="comment">! Compute quotients and sum to get total moment</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                            moments(i,dir,r) = (numer(i,r)/denom(i,r))**(1d0/<a class="code" href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">moment_order</a>(r))</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                            moments(i,dir,r) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#ade52fa354cc5b681c4d6ef6fc8b2c61b">s_symmetric_moments</a> <span class="comment">! ------------------------------------------ </span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#abdf1859a7ad678848feb69bbe89a2f95">s_derive_fluid_bounds</a>(q_prim_vf, bounds) <span class="comment">! -----------------------</span></div><div class="line"><a name="l01081"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#abdf1859a7ad678848feb69bbe89a2f95"> 1081</a></span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,5,6)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: bounds</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: cart_x, cart_y, cart_z</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: tmp</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,j,k,l,r</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> == 0) <span class="keywordflow">THEN</span> <span class="comment">! 1D simulation</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                        bounds(i,:,1) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! 1d6</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                        bounds(i,:,2) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! -1d6</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                        <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> <span class="comment">!Loop over grid</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                                            <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                                                .AND. (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1) &lt;= bounds(i,r,1))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                                                bounds(i,r,1) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1)</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                                            <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j) &gt;= bounds(i,r,2))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                                                bounds(i,r,2) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="keywordflow">                                        END DO</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                                    tmp = bounds(i,r,1)</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,bounds(i,r,1))</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                                    tmp = bounds(i,r,2)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,bounds(i,r,2))</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                                bounds(i,r,1) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                                bounds(i,r,2) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> == 0) <span class="keywordflow">THEN</span> <span class="comment">! 2D simulation</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                        bounds(i,:,1) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! 1d6</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                        bounds(i,:,2) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! -1d6</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                        bounds(i,:,3) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! 1d6</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                        bounds(i,:,4) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! -1d6</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                        <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span> </div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> <span class="comment">! Loop over grid</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a> </div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                                            <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                                                .AND. (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1) &lt;= bounds(i,r,1))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                                                bounds(i,r,1) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1)</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                                            <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j) &gt;= bounds(i,r,2))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                                                bounds(i,r,2) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                                            <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                                                .AND. (<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1) &lt;= bounds(i,r,3))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                                bounds(i,r,3) = <a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1)</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                                            <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k) &gt;= bounds(i,r,4))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                                                bounds(i,r,4) = <a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k)</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="keywordflow">                                        END DO</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                                    tmp = bounds(i,r,1)</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,bounds(i,r,1))</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                                    tmp = bounds(i,r,2)</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,bounds(i,r,2))</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                                    tmp = bounds(i,r,3)</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,bounds(i,r,3))</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                                    tmp = bounds(i,r,4)</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,bounds(i,r,4))</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                                bounds(i,r,1) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                                bounds(i,r,2) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                                bounds(i,r,3) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                                bounds(i,r,4) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            <span class="keywordflow">ELSE</span> <span class="comment">! 3D simulation</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                        bounds(i,:,1) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! 1d6</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                        bounds(i,:,2) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! -1d6</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                        bounds(i,:,3) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! 1d6</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                        bounds(i,:,4) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! -1d6</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                        bounds(i,:,5) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! 1d6</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                        bounds(i,:,6) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a> <span class="comment">! -1d6</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                        <span class="keywordflow">DO</span> r = 1, 5 </div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> <span class="comment">! Loop over grid</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a> </div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                                                cart_x = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*cos(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                                                cart_y = <a class="code" href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">y_cc</a>(k)*sin(<a class="code" href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">z_cc</a>(l))</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                                                cart_z = <a class="code" href="namespacem__global__parameters.html#aea5b911d65b330f65e97052e9e8c0383">x_cc</a>(j)</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                                                <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                                                    .AND. (cart_x &lt;= bounds(i,r,1))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                                                    bounds(i,r,1) = cart_x</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp; </div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                                                    .AND. (cart_x &gt;= bounds(i,r,2))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                                                    bounds(i,r,2) = cart_x</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                                                <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp; </div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                                                    .AND. (cart_y &lt;= bounds(i,r,3))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                                                    bounds(i,r,3) = cart_y</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;  </div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                                                    .AND. (cart_y &gt;= bounds(i,r,4))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                                                    bounds(i,r,4) = cart_y</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                                                <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp; </div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                                                    .AND. (cart_z &lt;= bounds(i,r,5))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                                                    bounds(i,r,5) = cart_z</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;  </div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                                    .AND. (cart_z &gt;= bounds(i,r,6))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                                                    bounds(i,r,6) = cart_z</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                                                <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;  </div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1) &lt;= bounds(i,r,1))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                                                    bounds(i,r,1) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp; </div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j) &gt;= bounds(i,r,2))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                                                    bounds(i,r,2) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j)</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                                                <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp;  </div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1) &lt;= bounds(i,r,3))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                                                    bounds(i,r,3) = <a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1)</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp; </div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k) &gt;= bounds(i,r,4))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                                                    bounds(i,r,4) = <a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k)</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                                                <span class="keywordflow">IF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp; </div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(l-1) &lt;= bounds(i,r,5))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                                                    bounds(i,r,5) = <a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(l-1)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                                                <span class="keywordflow">ELSEIF</span> ((q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) &amp; </div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                                                    .AND. (<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(l) &gt;= bounds(i,r,6))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                                                    bounds(i,r,6) = <a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(l)</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="keywordflow">                                        END DO</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                                    tmp = bounds(i,r,1)</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,bounds(i,r,1))</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                                    tmp = bounds(i,r,2)</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,bounds(i,r,2))</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                    tmp = bounds(i,r,3)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,bounds(i,r,3))</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                                    tmp = bounds(i,r,4)</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,bounds(i,r,4))</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                                    tmp = bounds(i,r,5)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,bounds(i,r,5))</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                                    tmp = bounds(i,r,6)</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,bounds(i,r,6))</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                                bounds(i,r,1) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                                bounds(i,r,2) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                                bounds(i,r,3) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                                bounds(i,r,4) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                                bounds(i,r,5) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                                bounds(i,r,6) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#abdf1859a7ad678848feb69bbe89a2f95">s_derive_fluid_bounds</a> <span class="comment">! -------------------------------------------</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a2472e46739cdedf315aefa209a08f211">s_derive_coherent_body</a>(q_prim_vf, cb_mass) <span class="comment">! --------------------------</span></div><div class="line"><a name="l01280"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a2472e46739cdedf315aefa209a08f211"> 1280</a></span>&#160;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,10)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: cb_mass</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: dV</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,j,k,l,r</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: tmp</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            <span class="keywordflow">DO</span> i = 1,<a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a> <span class="comment">!Loop over individual fluids</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                    cb_mass(i,:) = 0d0</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                    <span class="keywordflow">DO</span> r = 1, 5 <span class="comment">! Volume fraction threshold values</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                            <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> <span class="comment">!Loop over grid</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                                <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                                    <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                                        <span class="keywordflow">IF</span> (q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> == 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                                                dv = <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                                            <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> == 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                                                dv = <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                                                    dv = (2d0*<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k) + <a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)**2d0)/2d0*<a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                                                <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                                                    dv = <a class="code" href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">dx</a>(j)*<a class="code" href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">dy</a>(k)*<a class="code" href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">dz</a>(l)</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="keywordflow">                                                END IF</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                                            cb_mass(i,r) = cb_mass(i,r) + q_prim_vf(i)%sf(j,k,l)*dv <span class="comment">! Mass</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                                            cb_mass(i,r+5) = cb_mass(i,r+5) + dv <span class="comment">! Volume</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keywordflow">                                        END IF</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="keywordflow">                            END DO</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                                tmp = cb_mass(i,r)</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,cb_mass(i,r))</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                                tmp = cb_mass(i,r+5)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                                <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">s_mpi_allreduce_sum</a>(tmp,cb_mass(i,r+5))</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                            cb_mass(i,r) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                            cb_mass(i,r+5) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;            <span class="keywordflow">DO</span> i = 1, <a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                    <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                        <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                            <span class="comment">! Check for reflective BC in x-direction</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a18f8ba3144b698c2753731b6e27fc581">bc_x_glb</a>%beg == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                cb_mass(i,r) = cb_mass(i,r)*2d0</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                                cb_mass(i,r+5) = cb_mass(i,r+5)*2d0</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                            <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#a18f8ba3144b698c2753731b6e27fc581">bc_x_glb</a>%end == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                                cb_mass(i,r) = cb_mass(i,r)*2d0</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                                cb_mass(i,r+5) = cb_mass(i,r+5)*2d0</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                            <span class="keywordflow">IF</span> ( <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> &gt; 0 ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                                <span class="comment">! Check for reflective BC in y-direction</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%beg == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                                    cb_mass(i,r) = cb_mass(i,r)*2d0</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                                    cb_mass(i,r+5) = cb_mass(i,r+5)*2d0</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                                <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">bc_y_glb</a>%end == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                                    cb_mass(i,r) = cb_mass(i,r)*2d0</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                                    cb_mass(i,r+5) = cb_mass(i,r+5)*2d0</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                                <span class="keywordflow">IF</span> ( <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> &gt; 0 ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                                    <span class="comment">! Check for reflective BC in z-direction</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%beg == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                                        cb_mass(i,r) = cb_mass(i,r)*2d0</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                                        cb_mass(i,r+5) = cb_mass(i,r+5)*2d0</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                                    <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">bc_z_glb</a>%end == -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                                        cb_mass(i,r) = cb_mass(i,r)*2d0</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                                        cb_mass(i,r+5) = cb_mass(i,r+5)*2d0</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="keywordflow">                                    END IF</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                                    </div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="keywordflow">                        END IF</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="keywordflow">                    END DO</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="keywordflow">            END DO</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a2472e46739cdedf315aefa209a08f211">s_derive_coherent_body</a> <span class="comment">! ------------------------------</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a976bfd341efaba6840dc23d6abc4f29e">s_derive_centerline</a>(q_prim_vf, cntrline) <span class="comment">! --------------------------</span></div><div class="line"><a name="l01380"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a976bfd341efaba6840dc23d6abc4f29e"> 1380</a></span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            <span class="keywordtype">TYPE</span>(<a class="code" href="structm__derived__types_1_1scalar__field.html">scalar_field</a>), <span class="keywordtype">DIMENSION(sys_size)</span>, <span class="keywordtype">INTENT(IN)</span> :: q_prim_vf</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(num_fluids,5)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: cntrline</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span>, <span class="keywordtype">DIMENSION(5)</span> :: cntrmin, cntrmax</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            <span class="keywordtype">REAL(KIND(0d0))</span> :: tmp</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            <span class="keywordtype">INTEGER</span> :: i,j,k,l,r</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a> == 0) <span class="keywordflow">THEN</span> <span class="comment">! 1D simulation</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                <span class="keywordflow">DO</span> i = 1, <a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                        <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                                cntrline(i,r) = 0d0</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                                cntrline(i,r) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            <span class="keywordflow">ELSEIF</span> ((<a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a> == 0) .OR. (<a class="code" href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">grid_geometry</a> == 3)) <span class="keywordflow">THEN</span> <span class="comment">! 2D simulation</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                <span class="keywordflow">DO</span> i = 1, <a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                        cntrmin(:) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                        cntrmax(:) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                        <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                                            <span class="keywordflow">IF</span> (    (<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1) == 0d0) .AND. &amp;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                                                (q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) .AND. &amp;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                                                (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1) &lt;= cntrmin(r)) ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                                                    cntrmin(r) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1)</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                                            <span class="keywordflow">ELSEIF</span> ((<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1) == 0d0) .AND. &amp;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                                                (q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) .AND. &amp;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                                                (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j) &gt;= cntrmax(r)) ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                                                    cntrmax(r) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j)</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="keywordflow">                                        END DO</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                                    tmp = cntrmin(r)</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,cntrmin(r))</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                                    tmp = cntrmax(r)</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,cntrmax(r))</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                                cntrline(i,r) = cntrmax(r) - cntrmin(r)</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                                cntrline(i,r) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            <span class="keywordflow">ELSE</span> <span class="comment">! 3D simulation</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                <span class="keywordflow">DO</span> i = 1, <a class="code" href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">num_fluids</a></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                    <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>(i)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                        cntrmin(:) = -1d0*<a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                        cntrmax(:) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                        <span class="keywordflow">DO</span> r = 1, 5</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r) /= <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                                <span class="keywordflow">DO</span> l = 0, <a class="code" href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">p</a></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                                    <span class="keywordflow">DO</span> k = 0, <a class="code" href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">n</a></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                                        <span class="keywordflow">DO</span> j = 0, <a class="code" href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m</a></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                                            <span class="keywordflow">IF</span> (    (<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1) == 0d0) .AND. &amp;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                                                    (<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(l-1) == 0d0) .AND. &amp;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                                                (q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) .AND. &amp;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                                                (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1) &lt;= cntrmin(r)) ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                                                    cntrmin(r) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j-1)</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                                            <span class="keywordflow">ELSEIF</span> ((<a class="code" href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">y_cb</a>(k-1) == 0d0) .AND. &amp;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                                                    (<a class="code" href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">z_cb</a>(l-1) == 0d0) .AND. &amp;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                                                (q_prim_vf(i+<a class="code" href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">e_idx</a>)%sf(j,k,l) &gt;= <a class="code" href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">threshold_mf</a>(r)) .AND. &amp;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                                                (<a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j) &gt;= cntrmax(r)) ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                                                    cntrmax(r) = <a class="code" href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">x_cb</a>(j)</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="keywordflow">                                            END IF</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="keywordflow">                                        END DO</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="keywordflow">                                    END DO</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="keywordflow">                                END DO</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">num_procs</a> &gt; 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                                    tmp = cntrmin(r)</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">s_mpi_allreduce_min</a>(tmp,cntrmin(r))</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                                    tmp = cntrmax(r)</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                                    <span class="keyword">CALL </span><a class="code" href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">s_mpi_allreduce_max</a>(tmp,cntrmax(r))</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="keywordflow">                                END IF</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                                cntrline(i,r) = cntrmax(r) - cntrmin(r)</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                                cntrline(i,r) = <a class="code" href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">dflt_real</a></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="keywordflow">                            END IF</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="keywordflow">                        END DO</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="keywordflow">                    END IF</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="keywordflow">                END DO</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a976bfd341efaba6840dc23d6abc4f29e">s_derive_centerline</a> <span class="comment">! ----------------------------------</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="keyword">        SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a735665bf598281689158d9d6e075f3d4">s_finalize_derived_variables_module</a>() <span class="comment">! -------------------</span></div><div class="line"><a name="l01488"></a><span class="lineno"><a class="line" href="namespacem__derived__variables.html#a735665bf598281689158d9d6e075f3d4"> 1488</a></span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            <span class="comment">! Closing CoM and flow probe files</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a383c6ff025d4ea09ddd4e2356042d86b">proc_rank</a> == 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                <span class="keywordflow">IF</span> (any(<a class="code" href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">com_wrt</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#a5646b1076ff72b2260ebefa3f44d4754">s_close_com_files</a>()</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                <span class="keywordflow">IF</span> (any(<a class="code" href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">cb_wrt</a>)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#aa0eb8be31f69888d750e18df197c6011">s_close_cb_files</a>()</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                <span class="keywordflow">IF</span> (<a class="code" href="namespacem__global__parameters.html#a2de4a56202a6e2f47ce657fcda4ecdb4">probe_wrt</a>) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                    <span class="keyword">CALL </span><a class="code" href="namespacem__data__output.html#a4036cc239adda35d59422a3e61bb657e">s_close_probe_files</a>()</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="keywordflow">                END IF</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="keywordflow">            END IF</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        </div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            <span class="comment">! Deallocating the variables that might have been used to bookkeep</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            <span class="comment">! the finite-difference coefficients in the x-, y- and z-directions</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            <span class="keywordflow">IF</span>(<span class="keyword">ALLOCATED</span>(<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>)) <span class="keyword">DEALLOCATE</span>(<a class="code" href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">fd_coeff_x</a>)</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            <span class="keywordflow">IF</span>(<span class="keyword">ALLOCATED</span>(<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>)) <span class="keyword">DEALLOCATE</span>(<a class="code" href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">fd_coeff_y</a>)</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            <span class="keywordflow">IF</span>(<span class="keyword">ALLOCATED</span>(<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>)) <span class="keyword">DEALLOCATE</span>(<a class="code" href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">fd_coeff_z</a>)</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            </div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            </div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="keyword">        END SUBROUTINE </span><a class="code" href="namespacem__derived__variables.html#a735665bf598281689158d9d6e075f3d4">s_finalize_derived_variables_module</a> <span class="comment">! -----------------</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        </div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        </div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        </div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        </div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        </div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="keyword">END MODULE </span><a class="code" href="namespacem__derived__variables.html">m_derived_variables</a></div><div class="ttc" id="namespacem__data__output_html_a1e7a93a0d32bbc7c691381689771b6f9"><div class="ttname"><a href="namespacem__data__output.html#a1e7a93a0d32bbc7c691381689771b6f9">m_data_output::bounds</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:,:), allocatable, public bounds</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00115">m_data_output.f90:115</a></div></div>
<div class="ttc" id="namespacem__data__output_html_aef4cabc25090173d5817782631af2781"><div class="ttname"><a href="namespacem__data__output.html#aef4cabc25090173d5817782631af2781">m_data_output::z_accel</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:,:), allocatable, public z_accel</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00117">m_data_output.f90:117</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a18f8ba3144b698c2753731b6e27fc581"><div class="ttname"><a href="namespacem__global__parameters.html#a18f8ba3144b698c2753731b6e27fc581">m_global_parameters::bc_x_glb</a></div><div class="ttdeci">type(bounds_info) bc_x_glb</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00159">m_global_parameters.f90:159</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a8892cc67c7d04be4d8e6d02a86e209bc"><div class="ttname"><a href="namespacem__global__parameters.html#a8892cc67c7d04be4d8e6d02a86e209bc">m_global_parameters::fd_order</a></div><div class="ttdeci">integer fd_order</div><div class="ttdoc">The order of the finite-difference (fd) approximations of the first-order derivatives that need to be...</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00255">m_global_parameters.f90:255</a></div></div>
<div class="ttc" id="namespacem__mpi__proxy_html_aff7286de058c49b2a5d7a84be1983e8f"><div class="ttname"><a href="namespacem__mpi__proxy.html#aff7286de058c49b2a5d7a84be1983e8f">m_mpi_proxy::s_mpi_allreduce_max</a></div><div class="ttdeci">subroutine s_mpi_allreduce_max(var_loc, var_glb)</div><div class="ttdoc">The following subroutine takes the input local variable from all processors and reduces to the maximu...</div><div class="ttdef"><b>Definition:</b> <a href="m__mpi__proxy_8f90_source.html#l01162">m_mpi_proxy.f90:1162</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a6be3381410dd028014de2c1d02b05139"><div class="ttname"><a href="namespacem__data__output.html#a6be3381410dd028014de2c1d02b05139">m_data_output::s_write_com_files</a></div><div class="ttdeci">subroutine, public s_write_com_files(t_step, q_com, moments)</div><div class="ttdoc">This writes a formatted data file where the root processor can write out the CoM information. </div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l01142">m_data_output.f90:1142</a></div></div>
<div class="ttc" id="namespacem__data__output_html"><div class="ttname"><a href="namespacem__data__output.html">m_data_output</a></div><div class="ttdoc">The primary purpose of this module is to output the grid and the conservative variables data at the c...</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00041">m_data_output.f90:41</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a29f34883bc8e9d895dbb4232493397a1"><div class="ttname"><a href="namespacem__data__output.html#a29f34883bc8e9d895dbb4232493397a1">m_data_output::s_write_probe_files</a></div><div class="ttdeci">subroutine, public s_write_probe_files(t_step, q_cons_vf, accel_mag)</div><div class="ttdoc">This writes a formatted data file for the flow probe information. </div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l01860">m_data_output.f90:1860</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_abdf1859a7ad678848feb69bbe89a2f95"><div class="ttname"><a href="namespacem__derived__variables.html#abdf1859a7ad678848feb69bbe89a2f95">m_derived_variables::s_derive_fluid_bounds</a></div><div class="ttdeci">subroutine s_derive_fluid_bounds(q_prim_vf, bounds)</div><div class="ttdoc">This subroutine is used together with the volume fraction model and when called upon, it computes the min and max bounds of the fluid in each direction in the domain. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l01081">m_derived_variables.f90:1081</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a1ccababc9891f8a719df1c52b49e969a"><div class="ttname"><a href="namespacem__data__output.html#a1ccababc9891f8a719df1c52b49e969a">m_data_output::accel_mag</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:,:), allocatable, public accel_mag</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00111">m_data_output.f90:111</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_ab28af564606ca901d3953e6012e9a452"><div class="ttname"><a href="namespacem__derived__variables.html#ab28af564606ca901d3953e6012e9a452">m_derived_variables::s_derive_higher_moments</a></div><div class="ttdeci">subroutine s_derive_higher_moments(q_prim_vf, moments)</div><div class="ttdoc">Subroutine to compute the higher moments in an attempt to find the maximal size of the droplet...</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00803">m_derived_variables.f90:803</a></div></div>
<div class="ttc" id="namespacem__time__steppers_html_a4bbe3aedc07e11e85679ec0c7a094f37"><div class="ttname"><a href="namespacem__time__steppers.html#a4bbe3aedc07e11e85679ec0c7a094f37">m_time_steppers::q_cons_ts</a></div><div class="ttdeci">type(vector_field), dimension(:), allocatable q_cons_ts</div><div class="ttdoc">Cell-average conservative variables at each time-stage (TS) </div><div class="ttdef"><b>Definition:</b> <a href="m__time__steppers_8f90_source.html#l00066">m_time_steppers.f90:66</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a3cafc9204d5773653e119ce3a3b98722"><div class="ttname"><a href="namespacem__derived__variables.html#a3cafc9204d5773653e119ce3a3b98722">m_derived_variables::fd_coeff_z</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:), allocatable, public fd_coeff_z</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00070">m_derived_variables.f90:70</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html"><div class="ttname"><a href="namespacem__global__parameters.html">m_global_parameters</a></div><div class="ttdoc">The module contains all of the parameters describing the program logistics, the computational domain ...</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00040">m_global_parameters.f90:40</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_aa75fcd53fdc4fb58ca0fbc2cc9678673"><div class="ttname"><a href="namespacem__global__parameters.html#aa75fcd53fdc4fb58ca0fbc2cc9678673">m_global_parameters::z_cb</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target z_cb</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00092">m_global_parameters.f90:92</a></div></div>
<div class="ttc" id="structm__derived__types_1_1scalar__field_html"><div class="ttname"><a href="structm__derived__types_1_1scalar__field.html">m_derived_types::scalar_field</a></div><div class="ttdoc">Derived type annexing a scalar field (SF) </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__types_8f90_source.html#l00048">m_derived_types.f90:48</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_aaa584e01b4153d246d84eef286482632"><div class="ttname"><a href="namespacem__global__parameters.html#aaa584e01b4153d246d84eef286482632">m_global_parameters::y_cc</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target y_cc</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00097">m_global_parameters.f90:97</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a735665bf598281689158d9d6e075f3d4"><div class="ttname"><a href="namespacem__derived__variables.html#a735665bf598281689158d9d6e075f3d4">m_derived_variables::s_finalize_derived_variables_module</a></div><div class="ttdeci">subroutine, public s_finalize_derived_variables_module()</div><div class="ttdoc">Deallocation procedures for the module. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l01488">m_derived_variables.f90:1488</a></div></div>
<div class="ttc" id="namespacem__data__output_html_af469c3d867d96eb1ca255832e586ec97"><div class="ttname"><a href="namespacem__data__output.html#af469c3d867d96eb1ca255832e586ec97">m_data_output::s_open_probe_files</a></div><div class="ttdeci">subroutine, public s_open_probe_files()</div><div class="ttdoc">This opens a formatted data file where the root processor can write out flow probe information...</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00362">m_data_output.f90:362</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_adc2bc27e809a773b7f5a6a65edac3b89"><div class="ttname"><a href="namespacem__global__parameters.html#adc2bc27e809a773b7f5a6a65edac3b89">m_global_parameters::dy</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target dy</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00102">m_global_parameters.f90:102</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a976bfd341efaba6840dc23d6abc4f29e"><div class="ttname"><a href="namespacem__derived__variables.html#a976bfd341efaba6840dc23d6abc4f29e">m_derived_variables::s_derive_centerline</a></div><div class="ttdeci">subroutine s_derive_centerline(q_prim_vf, cntrline)</div><div class="ttdoc">This subroutine is used together with the volume fraction model and when called upon, it computes the centerline length of the fluid. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l01380">m_derived_variables.f90:1380</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a800c19cad11fe2774ac137b12ec89e33"><div class="ttname"><a href="namespacem__global__parameters.html#a800c19cad11fe2774ac137b12ec89e33">m_global_parameters::x_cb</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target x_cb</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00092">m_global_parameters.f90:92</a></div></div>
<div class="ttc" id="namespacem__data__output_html_ac465283e56b508af6500bea1ad4c745c"><div class="ttname"><a href="namespacem__data__output.html#ac465283e56b508af6500bea1ad4c745c">m_data_output::x_accel</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:,:), allocatable, public x_accel</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00117">m_data_output.f90:117</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_af7508eba0a53c9a35913a502d58dfb54"><div class="ttname"><a href="namespacem__global__parameters.html#af7508eba0a53c9a35913a502d58dfb54">m_global_parameters::dx</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target dx</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00102">m_global_parameters.f90:102</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a40724c992117a24479573d9fbcdfa21b"><div class="ttname"><a href="namespacem__data__output.html#a40724c992117a24479573d9fbcdfa21b">m_data_output::s_write_cb_files</a></div><div class="ttdeci">subroutine, public s_write_cb_files(t_step, cb_mass, bounds, cntrline)</div><div class="ttdoc">The goal of this subroutine is to output coherent body information. </div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l01412">m_data_output.f90:1412</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_ab273055cd131e3ce73c1f468b78af7b7"><div class="ttname"><a href="namespacem__derived__variables.html#ab273055cd131e3ce73c1f468b78af7b7">m_derived_variables::fd_coeff_y</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:), allocatable, public fd_coeff_y</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00069">m_derived_variables.f90:69</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a5646b1076ff72b2260ebefa3f44d4754"><div class="ttname"><a href="namespacem__data__output.html#a5646b1076ff72b2260ebefa3f44d4754">m_data_output::s_close_com_files</a></div><div class="ttdeci">subroutine, public s_close_com_files()</div><div class="ttdoc">Closes communication files. </div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l02480">m_data_output.f90:2480</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_ace0c8a67825d0dccd2e23b5d0f9985c0"><div class="ttname"><a href="namespacem__global__parameters.html#ace0c8a67825d0dccd2e23b5d0f9985c0">m_global_parameters::t_step_start</a></div><div class="ttdeci">integer t_step_start</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00111">m_global_parameters.f90:111</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a36714d4cf746d5beb2736752fdd6d747"><div class="ttname"><a href="namespacem__data__output.html#a36714d4cf746d5beb2736752fdd6d747">m_data_output::s_open_com_files</a></div><div class="ttdeci">subroutine, public s_open_com_files()</div><div class="ttdoc">This opens a formatted data file where the root processor can write out the CoM information. </div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00227">m_data_output.f90:227</a></div></div>
<div class="ttc" id="namespacem__mpi__proxy_html_a873520062481f3dabcfa77f9bd7728d3"><div class="ttname"><a href="namespacem__mpi__proxy.html#a873520062481f3dabcfa77f9bd7728d3">m_mpi_proxy::s_mpi_allreduce_sum</a></div><div class="ttdeci">subroutine s_mpi_allreduce_sum(var_loc, var_glb)</div><div class="ttdoc">The following subroutine takes the input local variable from all processors and reduces to the sum of...</div><div class="ttdef"><b>Definition:</b> <a href="m__mpi__proxy_8f90_source.html#l01122">m_mpi_proxy.f90:1122</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_aeb29c88b4fa96ec8edcfed6c42861280"><div class="ttname"><a href="namespacem__global__parameters.html#aeb29c88b4fa96ec8edcfed6c42861280">m_global_parameters::bc_z_glb</a></div><div class="ttdeci">type(bounds_info) bc_z_glb</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00159">m_global_parameters.f90:159</a></div></div>
<div class="ttc" id="namespacem__derived__types_html"><div class="ttname"><a href="namespacem__derived__types.html">m_derived_types</a></div><div class="ttdoc">This module features the definitions of all the custom-defined derived types that are utilized throug...</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__types_8f90_source.html#l00036">m_derived_types.f90:36</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a411af1336ca1bc899d3b7352d9383a81"><div class="ttname"><a href="namespacem__data__output.html#a411af1336ca1bc899d3b7352d9383a81">m_data_output::s_open_cb_files</a></div><div class="ttdeci">subroutine, public s_open_cb_files()</div><div class="ttdoc">This opens a formatted data file where the root processor can write out the coherent body (cb) inform...</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00324">m_data_output.f90:324</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_ac040dbf547e6d5de8df08e864d8131e7"><div class="ttname"><a href="namespacem__global__parameters.html#ac040dbf547e6d5de8df08e864d8131e7">m_global_parameters::p</a></div><div class="ttdeci">integer p</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00076">m_global_parameters.f90:76</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a99ba7e33a1870ac89386d376e0d20526"><div class="ttname"><a href="namespacem__global__parameters.html#a99ba7e33a1870ac89386d376e0d20526">m_global_parameters::dflt_real</a></div><div class="ttdeci">real(kind(0d0)), parameter dflt_real</div><div class="ttdoc">Default real value. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00059">m_global_parameters.f90:59</a></div></div>
<div class="ttc" id="namespacem__data__output_html_aa0eb8be31f69888d750e18df197c6011"><div class="ttname"><a href="namespacem__data__output.html#aa0eb8be31f69888d750e18df197c6011">m_data_output::s_close_cb_files</a></div><div class="ttdeci">subroutine, public s_close_cb_files()</div><div class="ttdoc">Closes coherent body files. </div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l02496">m_data_output.f90:2496</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a9fef803dde37fd067fd4b2215df851b9"><div class="ttname"><a href="namespacem__global__parameters.html#a9fef803dde37fd067fd4b2215df851b9">m_global_parameters::z_cc</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target z_cc</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00097">m_global_parameters.f90:97</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html"><div class="ttname"><a href="namespacem__derived__variables.html">m_derived_variables</a></div><div class="ttdoc">This module features subroutines that allow for the derivation of numerous flow variables from the co...</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00039">m_derived_variables.f90:39</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a2f0b96a5aef3925aa7e3cc816754e17e"><div class="ttname"><a href="namespacem__global__parameters.html#a2f0b96a5aef3925aa7e3cc816754e17e">m_global_parameters::num_fluids</a></div><div class="ttdeci">integer num_fluids</div><div class="ttdoc">Number of fluids in the flow. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00120">m_global_parameters.f90:120</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_ac480f572058786c13c3e94efb6496a71"><div class="ttname"><a href="namespacem__global__parameters.html#ac480f572058786c13c3e94efb6496a71">m_global_parameters::bc_y_glb</a></div><div class="ttdeci">type(bounds_info) bc_y_glb</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00159">m_global_parameters.f90:159</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_ade52fa354cc5b681c4d6ef6fc8b2c61b"><div class="ttname"><a href="namespacem__derived__variables.html#ade52fa354cc5b681c4d6ef6fc8b2c61b">m_derived_variables::s_symmetric_moments</a></div><div class="ttdeci">subroutine s_symmetric_moments(q_prim_vf, moments, dir)</div><div class="ttdoc">Compute symmetric moments. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00984">m_derived_variables.f90:984</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_ad138d35528cf27ff42dba00d13c269be"><div class="ttname"><a href="namespacem__global__parameters.html#ad138d35528cf27ff42dba00d13c269be">m_global_parameters::mom_idx</a></div><div class="ttdeci">type(bounds_info) mom_idx</div><div class="ttdoc">Indexes of first &amp; last momentum eqns. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00187">m_global_parameters.f90:187</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a1a849dc545128f9a6de155bed61035ff"><div class="ttname"><a href="namespacem__derived__variables.html#a1a849dc545128f9a6de155bed61035ff">m_derived_variables::s_derive_center_of_mass</a></div><div class="ttdeci">subroutine s_derive_center_of_mass(q_prim_vf, q_prim_vf1, q_prim_vf2, q_prim_vf3, q_com)</div><div class="ttdoc">This subroutine is used together with the volume fraction model and when called upon, it computes the location of of the center of mass for each fluid from the inputted primitive variables, q_prim_vf. The computed location is then written to a formatted data file by the root process. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00446">m_derived_variables.f90:446</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a4ddb20fdeec324ed6100359e83111a7c"><div class="ttname"><a href="namespacem__global__parameters.html#a4ddb20fdeec324ed6100359e83111a7c">m_global_parameters::moment_order</a></div><div class="ttdeci">integer, dimension(5) moment_order</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00273">m_global_parameters.f90:273</a></div></div>
<div class="ttc" id="namespacem__data__output_html_ac5b476661d64159fdcd7364715495f30"><div class="ttname"><a href="namespacem__data__output.html#ac5b476661d64159fdcd7364715495f30">m_data_output::q_com</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:), allocatable, public q_com</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00112">m_data_output.f90:112</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a38317a39628eb007769f26f29b70c958"><div class="ttname"><a href="namespacem__global__parameters.html#a38317a39628eb007769f26f29b70c958">m_global_parameters::threshold_mf</a></div><div class="ttdeci">real(kind(0d0)), dimension(5) threshold_mf</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00272">m_global_parameters.f90:272</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a4bb8b661a170fc6ccd9fa3cc4b32c960"><div class="ttname"><a href="namespacem__global__parameters.html#a4bb8b661a170fc6ccd9fa3cc4b32c960">m_global_parameters::y_cb</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target y_cb</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00092">m_global_parameters.f90:92</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a2ee18c156bb444c6ab73d4762960ef67"><div class="ttname"><a href="namespacem__derived__variables.html#a2ee18c156bb444c6ab73d4762960ef67">m_derived_variables::s_non_symmetric_moments</a></div><div class="ttdeci">subroutine s_non_symmetric_moments(q_prim_vf, moments, dir)</div><div class="ttdoc">Compute non-symmetric moments. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00864">m_derived_variables.f90:864</a></div></div>
<div class="ttc" id="namespacem__time__steppers_html_a5fbb5dbdd477579d17f067ec7900e659"><div class="ttname"><a href="namespacem__time__steppers.html#a5fbb5dbdd477579d17f067ec7900e659">m_time_steppers::q_prim_ts</a></div><div class="ttdeci">type(vector_field), dimension(:), allocatable q_prim_ts</div><div class="ttdoc">Cell-average primitive variables at consecutive TIMESTEPS. </div><div class="ttdef"><b>Definition:</b> <a href="m__time__steppers_8f90_source.html#l00077">m_time_steppers.f90:77</a></div></div>
<div class="ttc" id="namespacem__mpi__proxy_html_a398a372625502c0430a64e0bb23e2342"><div class="ttname"><a href="namespacem__mpi__proxy.html#a398a372625502c0430a64e0bb23e2342">m_mpi_proxy::s_mpi_allreduce_min</a></div><div class="ttdeci">subroutine s_mpi_allreduce_min(var_loc, var_glb)</div><div class="ttdoc">The following subroutine takes the input local variable from all processors and reduces to the minimu...</div><div class="ttdef"><b>Definition:</b> <a href="m__mpi__proxy_8f90_source.html#l01142">m_mpi_proxy.f90:1142</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a0f2d413d9739928f8e1a98f0a5783ab9"><div class="ttname"><a href="namespacem__global__parameters.html#a0f2d413d9739928f8e1a98f0a5783ab9">m_global_parameters::grid_geometry</a></div><div class="ttdeci">integer grid_geometry</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00087">m_global_parameters.f90:87</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a4f2a6c0ed44fb82d337013e700479ce5"><div class="ttname"><a href="namespacem__data__output.html#a4f2a6c0ed44fb82d337013e700479ce5">m_data_output::cntrline</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:), allocatable, public cntrline</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00116">m_data_output.f90:116</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a9170ca95f1f4493fd30a48052ed214a7"><div class="ttname"><a href="namespacem__data__output.html#a9170ca95f1f4493fd30a48052ed214a7">m_data_output::y_accel</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:,:), allocatable, public y_accel</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00117">m_data_output.f90:117</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a15a6d70e2bd1c9b7001c753ca1f2ee27"><div class="ttname"><a href="namespacem__derived__variables.html#a15a6d70e2bd1c9b7001c753ca1f2ee27">m_derived_variables::s_initialize_derived_variables_module</a></div><div class="ttdeci">subroutine, public s_initialize_derived_variables_module()</div><div class="ttdoc">Computation of parameters, allocation procedures, and/or any other tasks needed to properly setup the...</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00080">m_derived_variables.f90:80</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_ac6ef72ca6aa7a22e60c864df25559892"><div class="ttname"><a href="namespacem__global__parameters.html#ac6ef72ca6aa7a22e60c864df25559892">m_global_parameters::e_idx</a></div><div class="ttdeci">integer e_idx</div><div class="ttdoc">Index of energy equation. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00188">m_global_parameters.f90:188</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a908281ae7fe786ef19397e268ede0ece"><div class="ttname"><a href="namespacem__derived__variables.html#a908281ae7fe786ef19397e268ede0ece">m_derived_variables::s_compute_finite_difference_coefficients</a></div><div class="ttdeci">subroutine s_compute_finite_difference_coefficients(q, s_cc, fd_coeff_s)</div><div class="ttdoc">The purpose of this subroutine is to compute the finite- difference coefficients for the centered sch...</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00224">m_derived_variables.f90:224</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a7fa880b937b54214312469a34268b883"><div class="ttname"><a href="namespacem__global__parameters.html#a7fa880b937b54214312469a34268b883">m_global_parameters::dt</a></div><div class="ttdeci">real(kind(0d0)) dt</div><div class="ttdoc">Size of the time-step. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00106">m_global_parameters.f90:106</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_aafb65952c33f1c363d1040bde29734ea"><div class="ttname"><a href="namespacem__global__parameters.html#aafb65952c33f1c363d1040bde29734ea">m_global_parameters::num_procs</a></div><div class="ttdeci">integer num_procs</div><div class="ttdoc">Number of processors. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00054">m_global_parameters.f90:54</a></div></div>
<div class="ttc" id="namespacem__data__output_html_abd8505e33c0dce0f0aba7e27ae53bef5"><div class="ttname"><a href="namespacem__data__output.html#abd8505e33c0dce0f0aba7e27ae53bef5">m_data_output::moments</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:,:), allocatable, public moments</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00113">m_data_output.f90:113</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_ae9dbea9bb47e84dbd380c480ad5144b8"><div class="ttname"><a href="namespacem__derived__variables.html#ae9dbea9bb47e84dbd380c480ad5144b8">m_derived_variables::s_initialize_derived_variables</a></div><div class="ttdeci">subroutine, public s_initialize_derived_variables()</div><div class="ttdoc">Allocate and open derived variables. Computing FD coefficients. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00108">m_derived_variables.f90:108</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a2ed9e718df8c2a250e5d8cce2e04cbb7"><div class="ttname"><a href="namespacem__global__parameters.html#a2ed9e718df8c2a250e5d8cce2e04cbb7">m_global_parameters::cb_wrt</a></div><div class="ttdeci">logical, dimension(num_fluids_max) cb_wrt</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00265">m_global_parameters.f90:265</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a4036cc239adda35d59422a3e61bb657e"><div class="ttname"><a href="namespacem__data__output.html#a4036cc239adda35d59422a3e61bb657e">m_data_output::s_close_probe_files</a></div><div class="ttdeci">subroutine, public s_close_probe_files()</div><div class="ttdoc">Closes probe files. </div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l02512">m_data_output.f90:2512</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_ac72422e5f77149bd32cf0cfd01a36544"><div class="ttname"><a href="namespacem__global__parameters.html#ac72422e5f77149bd32cf0cfd01a36544">m_global_parameters::n</a></div><div class="ttdeci">integer n</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00076">m_global_parameters.f90:76</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a60d7ab72fdab2b005144a5a45aa572de"><div class="ttname"><a href="namespacem__global__parameters.html#a60d7ab72fdab2b005144a5a45aa572de">m_global_parameters::fd_number</a></div><div class="ttdeci">integer fd_number</div><div class="ttdoc">The finite-difference number is given by MAX(1, fd_order/2). Essentially, it is a measure of the half...</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00260">m_global_parameters.f90:260</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a4f61d6bef7f53e49a0f5e4a3f9577912"><div class="ttname"><a href="namespacem__derived__variables.html#a4f61d6bef7f53e49a0f5e4a3f9577912">m_derived_variables::fd_coeff_x</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:), allocatable, public fd_coeff_x</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00068">m_derived_variables.f90:68</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a2de4a56202a6e2f47ce657fcda4ecdb4"><div class="ttname"><a href="namespacem__global__parameters.html#a2de4a56202a6e2f47ce657fcda4ecdb4">m_global_parameters::probe_wrt</a></div><div class="ttdeci">logical probe_wrt</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00266">m_global_parameters.f90:266</a></div></div>
<div class="ttc" id="namespacem__data__output_html_a775b8128a9261b4d095f9132508d309f"><div class="ttname"><a href="namespacem__data__output.html#a775b8128a9261b4d095f9132508d309f">m_data_output::cb_mass</a></div><div class="ttdeci">real(kind(0d0)), dimension(:,:), allocatable, public cb_mass</div><div class="ttdef"><b>Definition:</b> <a href="m__data__output_8f90_source.html#l00114">m_data_output.f90:114</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a5c6df8a69a463ae2c56fb2c2bb8c59a7"><div class="ttname"><a href="namespacem__derived__variables.html#a5c6df8a69a463ae2c56fb2c2bb8c59a7">m_derived_variables::s_derive_acceleration_component</a></div><div class="ttdeci">subroutine s_derive_acceleration_component(i, q_prim_vf, q_prim_vf1, q_prim_vf2, q_prim_vf3, q_sf)</div><div class="ttdoc">This subroutine receives as inputs the indicator of the component of the acceleration that should be ...</div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00286">m_derived_variables.f90:286</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_aea5b911d65b330f65e97052e9e8c0383"><div class="ttname"><a href="namespacem__global__parameters.html#aea5b911d65b330f65e97052e9e8c0383">m_global_parameters::x_cc</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target x_cc</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00097">m_global_parameters.f90:97</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a36d8d56515556bc34bc0c88da60f6b62"><div class="ttname"><a href="namespacem__global__parameters.html#a36d8d56515556bc34bc0c88da60f6b62">m_global_parameters::com_wrt</a></div><div class="ttdeci">logical, dimension(num_fluids_max) com_wrt</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00265">m_global_parameters.f90:265</a></div></div>
<div class="ttc" id="namespacem__mpi__proxy_html_a04ac565bad2b22dc045a5eeb4f516e2e"><div class="ttname"><a href="namespacem__mpi__proxy.html#a04ac565bad2b22dc045a5eeb4f516e2e">m_mpi_proxy::s_mpi_abort</a></div><div class="ttdeci">subroutine s_mpi_abort()</div><div class="ttdoc">The subroutine terminates the MPI execution environment. </div><div class="ttdef"><b>Definition:</b> <a href="m__mpi__proxy_8f90_source.html#l00104">m_mpi_proxy.f90:104</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a04878814b8097100a179152ba853262a"><div class="ttname"><a href="namespacem__global__parameters.html#a04878814b8097100a179152ba853262a">m_global_parameters::dz</a></div><div class="ttdeci">real(kind(0d0)), dimension(:), allocatable, target dz</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00102">m_global_parameters.f90:102</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a516a9808b3446b7b45029f6451d02b3f"><div class="ttname"><a href="namespacem__derived__variables.html#a516a9808b3446b7b45029f6451d02b3f">m_derived_variables::s_compute_derived_variables</a></div><div class="ttdeci">subroutine, public s_compute_derived_variables(t_step)</div><div class="ttdoc">Writes coherent body information, communication files, and probes. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l00142">m_derived_variables.f90:142</a></div></div>
<div class="ttc" id="namespacem__time__steppers_html"><div class="ttname"><a href="namespacem__time__steppers.html">m_time_steppers</a></div><div class="ttdoc">The following module features a variety of time-stepping schemes. Currently, it includes the followin...</div><div class="ttdef"><b>Definition:</b> <a href="m__time__steppers_8f90_source.html#l00042">m_time_steppers.f90:42</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_aee38c9d03e9195858a93ec611b605f33"><div class="ttname"><a href="namespacem__global__parameters.html#aee38c9d03e9195858a93ec611b605f33">m_global_parameters::m</a></div><div class="ttdeci">integer m</div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00076">m_global_parameters.f90:76</a></div></div>
<div class="ttc" id="namespacem__derived__variables_html_a2472e46739cdedf315aefa209a08f211"><div class="ttname"><a href="namespacem__derived__variables.html#a2472e46739cdedf315aefa209a08f211">m_derived_variables::s_derive_coherent_body</a></div><div class="ttdeci">subroutine s_derive_coherent_body(q_prim_vf, cb_mass)</div><div class="ttdoc">This subroutine is used together with the volume fraction model and when called upon, it computes the total mass of a fluid in the entire domain for which the volume fraction is greater than a threshold value. This gives the mass of the coherent body. </div><div class="ttdef"><b>Definition:</b> <a href="m__derived__variables_8f90_source.html#l01280">m_derived_variables.f90:1280</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a4e4e3806190a62a77cf6542f6d07dbbd"><div class="ttname"><a href="namespacem__global__parameters.html#a4e4e3806190a62a77cf6542f6d07dbbd">m_global_parameters::dflt_int</a></div><div class="ttdeci">integer, parameter dflt_int</div><div class="ttdoc">Default integer value. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00060">m_global_parameters.f90:60</a></div></div>
<div class="ttc" id="namespacem__global__parameters_html_a383c6ff025d4ea09ddd4e2356042d86b"><div class="ttname"><a href="namespacem__global__parameters.html#a383c6ff025d4ea09ddd4e2356042d86b">m_global_parameters::proc_rank</a></div><div class="ttdeci">integer proc_rank</div><div class="ttdoc">Rank of the local processor. </div><div class="ttdef"><b>Definition:</b> <a href="m__global__parameters_8f90_source.html#l00072">m_global_parameters.f90:72</a></div></div>
<div class="ttc" id="namespacem__mpi__proxy_html"><div class="ttname"><a href="namespacem__mpi__proxy.html">m_mpi_proxy</a></div><div class="ttdoc">The module serves as a proxy to the parameters and subroutines available in the MPI implementation&amp;#39;s ...</div><div class="ttdef"><b>Definition:</b> <a href="m__mpi__proxy_8f90_source.html#l00039">m_mpi_proxy.f90:39</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_cff1091173cf1fe67371edd427ba236f.html">simulation_code</a></li><li class="navelem"><a class="el" href="m__derived__variables_8f90.html">m_derived_variables.f90</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
